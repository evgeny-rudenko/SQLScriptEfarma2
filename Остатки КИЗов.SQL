-- Остатки КИЗОв 
select 
  ISNULL (
  CONVERT
    (
        VARCHAR(MAX), 
        CAST('' AS XML).value('xs:base64Binary(sql:column("BARCODE"))', 'VARBINARY(MAX)')
    ) , BARCODE)AS KIZ,
BARCODE,GTIN, GTIN_SGTIN,SGTIN,
KIZ_ITEM.ID_LOT_GLOBAL , 
KIZ_ITEM.ID_DOCUMENT,
KIZ_ITEM.QUANTITY,
REMAINS.REMAIN_QTY
 from KIZ, KIZ_ITEM, LOT, 
 (
 select ID_KIZ_GLOBAL, MIN( REMAIN) as REMAIN_QTY
 from KIZ_2_DOCUMENT_ITEM
group by ID_KIZ_GLOBAL
 ) REMAINS
where KIZ.ID_KIZ_GLOBAL = KIZ_ITEM.ID_KIZ_GLOBAL
and lot.ID_LOT_GLOBAL = KIZ_ITEM.ID_LOT_GLOBAL
and REMAINS.ID_KIZ_GLOBAL = KIZ.ID_KIZ_GLOBAL

 
 
